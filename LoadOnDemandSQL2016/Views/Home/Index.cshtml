@{
    ViewBag.Title = "Home Page";
}



<div class="row">
    <div class="col-lg-12 text-center">
        <h3>Load On Demand Example</h3>
        <h4><span id="pRefresh" class="glyphicon glyphicon-refresh"></span></h4>
        <div class="text-left">
            <ul>
                <li>C# MVC</li>
                <li>SQL version 13.00.4001</li>
                <li>jQuery load on demand when scrolling.</li>
                <li>Scroll to the bottom of the page to load more results.</li>
            </ul>
        </div>
    </div>
</div>


@*Main data div, where results will be appended on jQuery call*@
<div class="row" id="main_data_row"></div>

@*Hidden var to hold the "page" number .. see sql file for number of items per page.*@
<input type="hidden" id="hPageNumber" value="1" />


@section scripts
{
   <script>
       $(document).ready(function () {
           GetResults();                    //Get Page 1 results on load.


           //After that, load the next page when they scroll to the bottom of the window.
            $(window).scroll(function() {
                if($(window).scrollTop() == $(document).height() - $(window).height()) {
                    GetResults();
                }
            });

           //set the page back to 1 if they re-fresh. You may or may not want to do this.
           $(window).on('beforeunload', function(){
               $("#hPageNumber").val('1');
           });

           $("#pRefresh").on('click', function () {
               location.reload();
           });
       });


       // jQuery call to get the current page of items.
       // Note: we increment the page number after each grab.
       function GetResults() {
           $.get('@Url.Action("GetItems","Home")?PageNumber=' + $("#hPageNumber").val(), null, function (html) {
               if (html !== '') {
                   $("#hPageNumber").val(parseInt($("#hPageNumber").val()) + 1);
                   $('#main_data_row').append(html);
               }
           })
                
       }
   </script>
}